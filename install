#!/bin/sh -e

DIR=$(readlink -f $(pwd)/$(dirname $0))

# Dotfiles
ls config | xargs -I FILE ln -sfn $DIR/config/FILE $HOME/.config/FILE
ls dotfiles | xargs -I FILE ln -sfn $DIR/dotfiles/FILE $HOME/.FILE

INSTALL='sudo pacman -S --needed --noconfirm'

# Haskell general
$INSTALL cabal-install
[ -d $HOME/.cabal ] || cabal update

# XMonad
$INSTALL gtk2hs-buildtools gconf libx11 libxrandr libxft
cabal install xmonad xmonad-extras MissingH blaze-html gconf

$INSTALL terminator

# Tianbar
$INSTALL gtk2 libxml2 webkitgtk2

cabal install tianbar

$HOME/.cabal/bin/xmonad --recompile

# Tianbar config
$INSTALL nodejs

cd $DIR/config/tianbar
npm install
./node_modules/.bin/bower install
cd - >/dev/null

# Synapse
$INSTALL synapse zeitgeist

# IBus
$INSTALL ibus ibus-pinyin ibus-m17n

# Session script
sudo install xinit.desktop /usr/share/xsessions
sudo install Xsession /etc/X11

$INSTALL notify-osd gnome-keyring
