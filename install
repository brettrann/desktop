#!/bin/sh -e

DIR=`pwd`/`dirname $0`

# Haskell general
sudo apt-get -y install cabal-install
[ -d ~/.cabal ] || cabal update

# XMonad
sudo apt-get -y install libx11-dev libxrandr-dev libxft-dev
cabal install xmonad xmonad-extras MissingH blaze-html

mkdir -p ~/.xmonad
ln -sf $DIR/xmonad.hs ~/.xmonad

# Tianbar
sudo apt-get -y install gtk2hs-buildtools libgtk2.0-dev libxml2-dev \
    libwebkitgtk-dev

cabal install tianbar

# Tianbar config
if [ ! -f /etc/apt/sources.list.d/chris-lea-node_js-$(lsb_release -sc).list ]
then
	sudo add-apt-repository -y ppa:chris-lea/node.js
	sudo apt-get update
fi
sudo apt-get -y install nodejs

cd $DIR/tianbar
npm install
./node_modules/.bin/bower install
cd - >/dev/null

ln -sf $DIR/tianbar ~/.config

# Synapse
sudo apt-get -y install synapse zeitgeist-core
ln -sf $DIR/synapse ~/.config

# IBus
sudo apt-get -y install ibus ibus-pinyin ibus-table ibus-m17n

# Session script
sudo install default.desktop /usr/share/xsessions
sudo apt-get -y install notify-osd xcompmgr

ln -sf $DIR/.xsession ~

sudo apt-get -y autoremove
