#!/bin/sh -e

DIR=`pwd`/`dirname $0`

INSTALL='sudo pacman -S --needed --noconfirm'

# Haskell general
$INSTALL cabal-install
[ -d $HOME/.cabal ] || cabal update

# XMonad
$INSTALL gtk2hs-buildtools gconf libx11 libxrandr libxft
cabal install xmonad xmonad-extras MissingH blaze-html gconf

mkdir -p $HOME/.xmonad
ln -sf $DIR/xmonad.hs $HOME/.xmonad

# Tianbar
$INSTALL gtk2 libxml2 webkitgtk2

cabal install tianbar

$HOME/.cabal/bin/xmonad --recompile

# Tianbar config
$INSTALL nodejs

cd $DIR/tianbar
npm install
./node_modules/.bin/bower install
cd - >/dev/null

ln -sf $DIR/tianbar $HOME/.config

# Synapse
$INSTALL synapse zeitgeist
ln -sf $DIR/synapse $HOME/.config

# IBus
$INSTALL ibus ibus-pinyin ibus-m17n

# Session script
sudo install gnome-xmonad.desktop /usr/share/xsessions

mkdir -p $HOME/.local/share/applications
ln -sf $DIR/*.desktop $HOME/.local/share/applications

mkdir -p $HOME/.config/gnome-session/sessions
ln -sf $DIR/xmonad.session $HOME/.config/gnome-session/sessions
